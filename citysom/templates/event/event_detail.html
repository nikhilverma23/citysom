{% extends "base.html" %}

{% block title%} {{eventdetails.title}} {% endblock %}

{% block content %}
<script type="text/javascript" src="/static/js/jquery.rating.js"></script>
<div class="links">
	<!--<li style="list-style: none; margin-top:5px; "><a href="#" style="text-decoration: none; color: #000;margin-left:22px;font-weight:bold;font-size: 16px; font-family: Calibri;"> < Back </a></li>-->
	<li style="list-style: none; width: 100%; margin-top: 14px; "><a href="#" style="text-decoration: none; color: #000;margin-left:33px;font-weight:bold;font-size: 18px; float: left; font-family: Calibri; margin-top: 10px;"><span>{{eventdetails.category}}</span> > <span style="color: #FF7920;">{{eventdetails.title}}</span> </a></li>
</div>
<!-- centerarea main end from here -->
<div class="clear"></div>
<div class="event_prev">
	<div class="left_img_prev">
	   <img src="/static/images/{{eventdetails.event_poster}}" alt="{{eventdetails.title}}"/>
	   <div>
		<a href="/myprofile/popularity?action=like&id={{eventdetails.id}}">
		<img src="/static/images/like.png" alt="like">
		</a>
		<a href='/myprofile/wishlist?action=add&id={{eventdetails.id}}'>
			<img src="/static/images/add_wishlist.png" alt="add_to_wishlist" height="30px";>
		</a>
	</div>
	   <a href="{{eventdetails.eventwebsite}}" style="color: #FF6600; font-size:0.85em; margin-top:0.5em; display:block;">{{eventdetails.eventwebsite}}</a>
		<!--<div>
			<button id="add_wishlist" class="uploader" value="Add to Wishlist" onclick="document.location.href='/myprofile/wishlist?action=add&id={{eventdetails.id}}';">Add to my wishlist</button>
		</div>-->
		<ul style="list-style: none; text-align: left;">
			<li class="prev_det"><strong>Event schedule:</strong></li>
			{% if eventdetails.schedule_type == "performance_based" %}
			
			Starts :{{eventdetails.event_start_date}}<br />
			Finishes : {{eventdetails.event_completion_date}}<br />
			Repeats:{{eventdetails.frequency|lower}}<br />
				{% if eventdetails.frequency == "DAILY" %}
					{% for performance in event_performance_values %}
						<li class="prev_det">
							{{performance.showtimes_start}} to {{performance.showtimes_end}} ${{performance.ticket_price}}
						</li>
					{% endfor %}
				{% elif eventdetails.frequency == "MONTHLY" %}
					Repeats every :{{eventdetails.interval}} month<br />
					Repeats on: {% if eventdetails.by_month == "1" %}
									First
								{% elif eventdetails.by_month == "2" %}
									Second
								{% elif eventdetails.by_month == "3" %}
									Third
								{% elif eventdetails.by_month == "4" %}
									Fourth
								{% else %}
									Last
								{% endif %} {{eventdetails.by_monthday}} of the month.
					{% for performance in event_performance_values %}
						<li class="prev_det">
							{{performance.showtimes_start}} to {{performance.showtimes_end}} ${{performance.ticket_price}}
						</li>
					{% endfor %}
				{% else %}
					{% if event_performance_values %}
						{% for performance in event_performance_values %}
							{% if total_days_consecutive > 2 %}
								<li class="prev_det">
									 {{first_day}}-{{last_day}} : {{performance.showtimes_start}} to {{performance.showtimes_end}} ${{performance.ticket_price}}
								</li>
							{% else %}
							     {% for days in eventdetails.by_day.all %}
							     
									<li class="prev_det">
										{{days}} : {{performance.showtimes_start}} to {{performance.showtimes_end}} ${{performance.ticket_price}}
							       </li>
							     {% endfor %}
							{% endif %}
						{% endfor %}
					{% endif %}
				
				{% endif %}
			  {% else %}
			  			Event Starts :{{eventdetails.event_start_date}}<br />
			Event Completes : {{eventdetails.event_completion_date}}<br />
				     	{% if eventdetails.location.start_hours_on_monday %}
							<li class="prev_det">
							Mondays: {{eventdetails.location.start_hours_on_monday}} to {{eventdetails.location.end_hours_on_monday}}
							</li>
						{% endif %}
						{% if eventdetails.location.start_hours_on_tuesday %}
							<li class="prev_det">
							Tuesdays: {{eventdetails.location.start_hours_on_tuesday}} to {{eventdetails.location.end_hours_on_tuesday}}
							</li>
						{% endif %}
						{% if eventdetails.location.start_hours_on_wednesday %}
							<li class="prev_det">
							Wednesdays: {{eventdetails.location.start_hours_on_wednesday}} to {{eventdetails.location.end_hours_on_wednesday}}
							</li>
						{% endif %}
						{% if eventdetails.location.start_hours_on_thursday %}
							<li class="prev_det">
							Thursdays: {{eventdetails.location.start_hours_on_thursday}} to {{eventdetails.location.end_hours_on_thursday}}
							</li>
						{% endif %}
						{% if eventdetails.location.start_hours_on_friday %}
							<li class="prev_det">
							Fridays: {{eventdetails.location.start_hours_on_friday}} to {{eventdetails.location.end_hours_on_friday}}
							</li>
						{% endif %}
						{% if eventdetails.location.start_hours_on_saturday %}
							<li class="prev_det">
							Saturdays: {{eventdetails.location.start_hours_on_saturday}} to {{eventdetails.location.end_hours_on_saturday}}
							</li>
						{% endif %}
						{% if eventdetails.location.start_hours_on_sunday %}
							<li class="prev_det">
							Sundays: {{eventdetails.location.start_hours_on_sunday}} to {{eventdetails.location.end_hours_on_sunday}}
							</li>
						{% endif %}
				     {% if not eventdetails.location.start_hours_on_sunday and not eventdetails.location.start_hours_on_monday and not eventdetails.location.start_hours_on_tuesday and not eventdetails.location.start_hours_on_wednesday and not eventdetails.location.start_hours_on_thursday and not eventdetails.location.start_hours_on_friday and not eventdetails.location.start_hours_on_saturday %}
				       
					     <span style="font-style:italic; margin-left:1em;">No show time information available</span>
				     
				     {% endif %}
			     
			     
			     {% endif %}
		</ul>
	</div>
	 <div class="right_det">
		<ul style="list-style: none;">
	   <li class="prev_tit" style="margin-bottom: 15px;"><strong>{{eventdetails.title}}</strong></li>
	   <li class="prev_det"><strong>Event description:</strong></li>
		<div class="event_desc">
		{{eventdetails.description|safe}}
	    </div>
		<!--<li class="prev_det"><strong>For more details:</strong> <a href="{{eventdetails.eventwebsite}}" style="color: #FF6600;">{{eventdetails.eventwebsite}}</a></li>-->
	    <li class="prev_det"><strong>Members' ratings:</strong></li>
	    {% if average_ratings %}
	    <span class="cust_ratin">
		    <div class="cust_rating">
		    	<div class="event_desc" style="display:inline-block !important;">Average rating:</div>
		    	<div class="rating_pic" style="display: inline-block; float: none; vertical-align:middle; margin-right:0.5em;">
					{% for star in total_stars%}
						<input name="averageratings" type="radio" class="star {split:2}" value="{{star}}" disabled="disabled" {% ifequal star average_ratings %}checked="checked"{% endifequal %}/>
					{%endfor%}
		    	</div>
		    	 based on {{comment_counter}} ratings
		    </div>
		    
	    </span>
	    <li class="prev_det"><strong>Members' reviews:</strong></li> 
	    {% endif %}
	   </ul>
	   <!--
	     <h6 style="font-weight: bold;margin-top: 15px;font-size: 17px; margin-bottom: 15px; margin-bottom: 15px;">Event URL: <a href="{{eventdetails.eventwebsite}}" style="color: #FF7920;">{{eventdetails.eventwebsite}}</a></h6>
	     
	     <h6 style="font-weight: bold;margin-top: 8px;font-size: 17px; margin-bottom: 15px; margin-bottom: 15px;">Event Description</h6>  
	    <div class="cust_ratin">
		{{eventdetails.description|safe}}
	    </div>
	     <span style="font-weight: bold;margin-top: 8px;font-size: 17px; margin-bottom: 15px; margin-bottom: 15px;">Customer's Reviews</span>
	    {% if average_ratings %}
	    <span class="cust_ratin">
		    <div class="rating" style="margin: 0px 10px; display: inline-block; float: none;">Average rating:</div>
		    <div class="rating_pic" style="display: inline-block; float: none;">
			{% for star in total_stars%}
				<input name="averageratings" type="radio" class="star {split:2}" value="{{star}}" disabled="disabled" {% ifequal star average_ratings %}checked="checked"{% endifequal %}/>
			{%endfor%}
		    </div>
	    </span>
	    <div class="clear"></div>  
	    {% endif %} -->
	    <!--<div class="rate_show">
		    <div class="rating" >Rate this show:</div>
		    <div class="rating_pic"><img src="/static/images/rate.png" alt="" style="margin-top: 0px;" /> </div>
	    </div>-->
	    <div id="latest_events">
		     <div class="clear"></div>   
		     <div class="review_sort">
			    <div class="lreview_sort">
				<strong style="margin-top:5px;">
					{% if user.is_authenticated %}
						<a href="#ratings_form" style="color: #FF7920; text-decoration:none !Important; font-size:0.85em;" id="ratings_link">Share your opinion <span style="font-size:1em;">></span></a>
					{% else %}
						<a href="#ratings_form" style="color: #FF7920;" onclick="alert('Sorry ... You need to log in first to write a review');">Share your opinion</a>
					{% endif %}
				</strong>
			    </div>
			    <div class="rate_show" style="float: right; width: auto !important;">
				    <div class="rating" style="float: left;width:60px;margin-top: 5px;font-weight: bold; font-size:0.85em;">Sort by</div>
				    <div class="rating_pic" style="float: right;width: 110px;margin-left: 5px;font-weight: bold">
				{% if sort_type == "asc" %}
					<a href="/event/details/?id={{eventdetails.id}}&sort_type=desc" style="color: #000000; text-decoration: none;">
				{% else %}
					<a href="/event/details/?id={{eventdetails.id}}&sort_type=asc" style="color: #000000; text-decoration: none;">
				{% endif %}
				<span style="font-size: 0.85em; font-weight:bold;">Most recent</span>
				{% if sort_type == "asc" %}
				    <img src="/static/images/up_arrow.png" alt="" style="margin-top: 0px;" />
				{% else %}
				    <img src="/static/images/dwn_arrow.png" alt="" style="margin-top: 0px;" />
				{% endif %}
				</a>
				</div>
			    </div>
		     </div>
			{% for comment in user_comments %}
				<div class="review_rating">
					<div class="clear"></div>
				       <div class="event_text">
				       </div>
					<div class="cust_ratin">
					      <div class="rating" style="font-style:bold; width: 500px;">
							<p style="font-weight: bold !important;">{{comment.title}}
							{% if comment.user_id == user.id and user.is_authenticated %}
								<a href="javascript:void(0)" class="edit_review" rel="{{comment.id}}" title="Edit {{comment.title}}"><img src="/static/images/edit_icon.png"></a>
								<a href="/event/comment_delete?id={{comment.id}}&event_id={{eventdetails.id}}" class="delete_review" title="Delete {{comment.title}}"><img src="/static/images/delete_icon.png"></a>
							{% endif %}
							</p>
					      </div>
					      <div class="rating_pic">
							{% for star in total_stars%}
								<input name="ratings_show{{comment.id}}" type="radio" class="star" value="{{star}}" disabled="disabled" {% ifequal star comment.ratings %}checked="checked"{% endifequal %}/>
							{%endfor%}
					      </div>
					      <div class="clear"></div>
					</div>
				    <div class="clear"></div>
				    <div class="comm_sign"><p>- by <span style="font-style:bold;">{{comment.user.username}}</span></p></div>
				    <div class="event_text">
						<p>{{comment.reviews}}</p>
					</div>
				</div> 
			{% endfor %}
	     </div>
	     <div id="ratings_div">
		<form name="ratings_form" action="" method="post" class="ratings_form">
			{% csrf_token %}
			<a name="ratings_form"></a>
			<h6 style="font-weight: normal;margin-bottom: 1em; margin-left:0.5em;font-size: 1.2em; color:#FF6600;">Share your opinion</h6>
			{{ratings_form.title.errors}}
			<p>
				<label for="id_title">Summary:</label>
				{{ratings_form.title}}
			</p>
			{{ratings_form.ratings.errors}}
			<p>
				<label for="id_ratings">Rating:</label>
				<span style="display: inline-block;">
					<input name="ratings" type="radio" class="star" value="1" id="id_ratings1"/>
					<input name="ratings" type="radio" class="star" value="2" id="id_ratings2"/>
					<input name="ratings" type="radio" class="star" value="3" id="id_ratings3"/>
					<input name="ratings" type="radio" class="star" value="4" id="id_ratings4"/>
					<input name="ratings" type="radio" class="star" value="5" id="id_ratings5"/>
				</span>
			</p>
			{{ratings_form.reviews.errors}}
			<p>
				<label for="id_reviews">Your opinion:</label>
				{{ratings_form.reviews}}
			</p>
			<p>
				<input type="hidden" name="id" id="comment_id" value="">
				<input type="submit" value="Share it!" class="custom_submit" style="margin-left: 135px;">
				<input type="button" value="Discard" class="custom_submit" style="margin-left: 10px;" id="discard">
			</p>
		</form>
	     </div>
	</div>
	   
</div>
<script>
	$("#ratings_link,#discard").click(function(){
		document.ratings_form.reset();
		$("#comment_id").val("");
		$("#ratings_div").toggle();
		$("#latest_events").toggle();
	});
	$("#ratings_div").hide();
	$(".edit_review").click(function(){
		comment_id = $(this).attr("rel");
		var title_div = $(this).parent();
		var title = title_div.children("strong").html();
		var rating_div = title_div.parent();
		var rating = rating_div.children(".rating_pic").children("input.star:checked").val();
		var review_div = rating_div.parent();
		var review = review_div.children(".event_text").children("p").html();
		
		$("#comment_id").val(comment_id);
		$("#id_title").val(title);
		$('input[name="ratings"]').rating('select',rating);
		$("#id_reviews").val(review);
		
		$("#latest_events").hide();
		$("#ratings_div").show();
	});
	$(".delete_review").click(function(e){
		if(!confirm('Are you sure you want to delete this ?'))
		{
			e.preventDefault();
		}
	});
</script>
{% if ratings_form.errors  %}
	<script>
		$("#ratings_link").click();
	</script>
{% endif %}
{% for detail in event_performance %}
	{{detial}}
{% endfor %}
{% endblock %}