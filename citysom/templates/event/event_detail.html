{% extends "base.html" %}

{% block title%} {{eventdetails.title}} {% endblock %}

{% block content %}
<script type="text/javascript" src="/static/js/jquery.rating.js"></script>
<div class="links">
	<!--<li style="list-style: none; margin-top:5px; "><a href="#" style="text-decoration: none; color: #000;margin-left:22px;font-weight:bold;font-size: 16px; font-family: Calibri;"> < Back </a></li>-->
	<li style="list-style: none; width: 100%; margin-top: 14px; "><a href="#" style="text-decoration: none; color: #000;margin-left:33px;font-weight:bold;font-size: 18px; float: left; font-family: Calibri; margin-top: 10px;">{{eventdetails.category}} > <p style="color: #FF7920; float: right;">{{eventdetails.title}}</p> </a></li>
</div>
<!-- centerarea main end from here -->
<div class="clear"></div>
<div class="event_prev">
	<div class="left_img_prev">
	   <img src="/static/images/{{eventdetails.event_poster}}" width="196" height="270" alt="{{eventdetails.title}}"/>
		<div>
			<button id="add_wishlist" class="uploader" value="Add to Wishlist" onclick="document.location.href='/myprofile/wishlist?action=add&id={{eventdetails.id}}';">Add to Wishlist</button>
		</div>
	</div>
	 <div class="right_det">
		<ul style="list-style: none;">
	   <li class="prev_det" style="margin-bottom: 15px;"><strong style="font-weight: bold;">{{eventdetails.title}} Details</strong></li> 
	   <li class="prev_det"><strong style="font-weight: bold;"></strong> </li> 
	   <li class="prev_det"><strong style="font-weight: bold;">Show time:</strong></li> 
	   {% if eventdetails.schedule_type == performance_based %}
		   {% for performancedetails in event_performance %}
		   
			   
			   {% for days in performancedetails.by_day.all %}
			   	<li class="prev_det" style="margin-left: 10px;">
			   		{{days}}:{{performancedetails.showtimes_start}}-{{performancedetails.showtimes_end}} - ${{performancedetails.ticket_price}}
			   </li> 
			   {% endfor %}
		   
		   {% endfor %}
		{% else %}
			{% if eventdetails.location.start_hours_on_monday %}
					<li class="prev_det" style="margin-left: 10px;">
						Monday:{{eventdetails.location.start_hours_on_monday}} - {{eventdetails.location.end_hours_on_monday}}
					</li>
			{% endif %}
			{% if eventdetails.location.start_hours_on_tuesday %}
				<li class="prev_det" style="margin-left: 10px;">
					Tuesday:{{eventdetails.location.start_hours_on_tuesday}} - {{eventdetails.location.end_hours_on_tuesday}}
				</li>
			{% endif %}
			{% if eventdetails.location.start_hours_on_wednesday %}
				<li class="prev_det" style="margin-left: 10px;">
					Wednesday:{{eventdetails.location.start_hours_on_wednesday}} - {{eventdetails.location.end_hours_on_wednesday}}
				</li>
			{% endif %}
			{% if eventdetails.location.start_hours_on_thursday %}
				<li class="prev_det" style="margin-left: 10px;">
					Thursday:{{eventdetails.location.start_hours_on_thursday}} - {{eventdetails.location.end_hours_on_thursday}}
				</li>
			{% endif %}
			{% if eventdetails.location.start_hours_on_friday %}
				<li class="prev_det" style="margin-left: 10px;">
					Friday:{{eventdetails.location.start_hours_on_friday}} - {{eventdetails.location.end_hours_on_friday}}
				</li>
			{% endif %}
			{% if eventdetails.location.start_hours_on_saturday %}
				<li class="prev_det" style="margin-left: 10px;">
					Saturday:{{eventdetails.location.start_hours_on_saturday}} - {{eventdetails.location.end_hours_on_saturday}}
				</li>
			{% endif %}
			{% if eventdetails.location.start_hours_on_sunday %}
				<li class="prev_det" style="margin-left: 10px;">
					Sunday:{{eventdetails.location.start_hours_on_sunday}} - {{eventdetails.location.end_hours_on_sunday}}
				</li>
			{% endif %}
			{% if not eventdetails.location.start_hours_on_sunday and not eventdetails.location.start_hours_on_monday and not eventdetails.location.start_hours_on_tuesday and not eventdetails.location.start_hours_on_wednesday and not eventdetails.location.start_hours_on_thursday and not eventdetails.location.start_hours_on_friday and not eventdetails.location.start_hours_on_saturday %}
			  
				Show time yet to be decided
			
			{% endif %}
		
		
		{% endif %}
	   </ul>
	     <h6 style="font-weight: bold;margin-top: 15px;font-size: 17px; margin-bottom: 15px; margin-bottom: 15px;">Event URL: <a href="{{eventdetails.eventwebsite}}" style="color: #FF7920;">{{eventdetails.eventwebsite}}</a></h6>
	     
	     <h6 style="font-weight: bold;margin-top: 8px;font-size: 17px; margin-bottom: 15px; margin-bottom: 15px;">Event Description</h6>  
	    <div class="cust_ratin">
		{{eventdetails.description}}
	    </div>
	     <h6 style="font-weight: bold;margin-top: 8px;font-size: 17px; margin-bottom: 15px; margin-bottom: 15px;">Customer's Reviews</h6>
	    {% if average_ratings %}
	    <div class="cust_ratin">
		    <div class="rating" style="margin-right: 10px;">Average rating:</div>
		    <div class="rating_pic">
			{% for star in total_stars%}
				<input name="averageratings" type="radio" class="star" value="{{star}}" disabled="disabled" {% ifequal star average_ratings %}checked="checked"{% endifequal %}/>
			{%endfor%}
		    </div>
	    </div>
	    <div class="clear"></div>  
	    {% endif %}
	    <!--<div class="rate_show">
		    <div class="rating" >Rate this show:</div>
		    <div class="rating_pic"><img src="/static/images/rate.png" alt="" style="margin-top: 0px;" /> </div>
	    </div>-->
	    <div id="latest_events">
		     <div class="clear"></div>   
		     <div class="review_sort">
			    <div class="lreview_sort">
				<strong style="font-weight: bold;margin-top:5px;">
					{% if user.is_authenticated %}
						<a href="#ratings_form" style="color: #FF7920;" id="ratings_link">Write a review</a>
					{% else %}
						<a href="#ratings_form" style="color: #FF7920;" onclick="alert('Login in first to write a review');">Write a review</a>
					{% endif %}
				</strong>
			    </div>
			    <div class="rate_show" style="float: right; width: auto !important;">
				    <div class="rating" style="float: left;width:60px;margin-top: 5px;font-weight:  bold;">Sort By</div>
				    <div class="rating_pic" style="float: right;width: 110px;margin-left: 5px;font-weight: bold">
				{% if sort_type == "asc" %}
					<a href="/event/details/?id={{eventdetails.id}}&sort_type=desc" style="color: #000000; text-decoration: none;">
				{% else %}
					<a href="/event/details/?id={{eventdetails.id}}&sort_type=asc" style="color: #000000; text-decoration: none;">
				{% endif %}
				Most Recent
				{% if sort_type == "asc" %}
				    <img src="/static/images/up_arrow.png" alt="" style="margin-top: 0px;" />
				{% else %}
				    <img src="/static/images/dwn_arrow.png" alt="" style="margin-top: 0px;" />
				{% endif %}
				</a>
				</div>
			    </div>
		     </div>
			{% for comment in user_comments %}
				<div class="review_rating">
					<div class="clear"></div>
				       <div class="event_text">
				       </div>
					<div class="cust_ratin">
					      <div class="rating" style="width: 200px;">
						<strong style="font-weight: bold;">{{comment.title}}</strong>
						{% if comment.user_id == user.id and user.is_authenticated %}
							<a href="javascript:void(0)" class="edit_review" rel="{{comment.id}}" title="Edit {{comment.title}}"><img src="/static/images/edit_icon.png"></a>
							<a href="/event/comment_delete?id={{comment.id}}&event_id={{eventdetails.id}}" class="delete_review" title="Delete {{comment.title}}"><img src="/static/images/delete_icon.png"></a>
						
						{% endif %}
					      </div>
					      <div class="rating_pic">
						{% for star in total_stars%}
							<input name="ratings_show{{comment.id}}" type="radio" class="star" value="{{star}}" disabled="disabled" {% ifequal star comment.ratings %}checked="checked"{% endifequal %}/>
						{%endfor%}
					      </div>
					      <div class="clear"></div>
				       </div>
				       <div class="clear"></div>
				       <div class="event_text">
				       <p>{{comment.reviews}}</p>
				       </div>
				       
			       </div> 
			{% endfor %}
	     </div>
	     <div id="ratings_div">
		<form name="ratings_form" action="" method="post" class="ratings_form">
			{% csrf_token %}
			<a name="ratings_form"></a>
			<h6 style="font-weight: normal;margin-bottom: 1em; margin-left:0.5em;font-size: 1.2em; color:#FF6600;">Share your opinion</h6>
			{{ratings_form.title.errors}}
			<p>
				<label for="id_title">Summary:</label>
				{{ratings_form.title}}
			</p>
			{{ratings_form.ratings.errors}}
			<p>
				<label for="id_ratings">Rating:</label>
				<span style="display: inline-block;">
					<input name="ratings" type="radio" class="star" value="1" id="id_ratings1"/>
					<input name="ratings" type="radio" class="star" value="2" id="id_ratings2"/>
					<input name="ratings" type="radio" class="star" value="3" id="id_ratings3"/>
					<input name="ratings" type="radio" class="star" value="4" id="id_ratings4"/>
					<input name="ratings" type="radio" class="star" value="5" id="id_ratings5"/>
				</span>
			</p>
			{{ratings_form.reviews.errors}}
			<p>
				<label for="id_reviews">Your opinion:</label>
				{{ratings_form.reviews}}
			</p>
			<p>
				<input type="hidden" name="id" id="comment_id" value="">
				<input type="submit" value="Share it!" class="custom_submit" style="margin-left: 135px;">
				<input type="button" value="Discard" class="custom_submit" style="margin-left: 10px;" id="discard">
			</p>
		</form>
	     </div>
	</div>
	   
</div>
<script>
	$("#ratings_link,#discard").click(function(){
		document.ratings_form.reset();
		$("#comment_id").val("");
		$("#ratings_div").toggle();
		$("#latest_events").toggle();
	});
	$("#ratings_div").hide();
	$(".edit_review").click(function(){
		comment_id = $(this).attr("rel");
		var title_div = $(this).parent();
		var title = title_div.children("strong").html();
		var rating_div = title_div.parent();
		var rating = rating_div.children(".rating_pic").children("input.star:checked").val();
		var review_div = rating_div.parent();
		var review = review_div.children(".event_text").children("p").html();
		
		$("#comment_id").val(comment_id);
		$("#id_title").val(title);
		$('input[name="ratings"]').rating('select',rating);
		$("#id_reviews").val(review);
		
		$("#latest_events").hide();
		$("#ratings_div").show();
	});
	$(".delete_review").click(function(e){
		if(!confirm('Are you sure you want to delete this ?'))
		{
			e.preventDefault();
		}
	});
</script>
{% if ratings_form.errors  %}
	<script>
		$("#ratings_link").click();
	</script>
{% endif %}
{% for detail in event_performance %}
	{{detial}}
{% endfor %}
{% endblock %}